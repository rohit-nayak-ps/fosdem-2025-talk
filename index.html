<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Vitess Migration</title>
    <link
            rel="stylesheet"
            href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
    />
    <link
            rel="stylesheet"
            href="css/styles.css"
    />
</head>
<body>

<!-- Wrap both divs in a parent container with inline CSS -->
<div style="
  display: flex;
  flex-direction: row;
  justify-content: space-between;
  align-items: center;
  width: 100%;
">
    <div class="title" style="xwidth:50%;text-align: center">
        <h1 style="color:#F05E19">Migrating to Vitess</h1>
    </div>

    <div class="step-buttons">
        <button class="step-btn" data-step="0">Initial</button>
        <button class="step-btn" data-step="1">Setup Vitess</button>
        <button class="step-btn" data-step="2">Start Migration</button>
        <button class="step-btn" data-step="3">Switch Reads</button>
        <button class="step-btn" data-step="4">Switch Writes</button>
        <button class="step-btn" data-step="5">Complete</button>
    </div>
</div>


<!-- Step 0 Content -->
<div id="step-0" class="step-block show" data-step="0">
    <div class="diagram-container">
        <!-- Block: User Application -->
        <div class="block user-app">
            <i class="fas fa-user fa-2x"></i>
            <p>User Application</p>
        </div>

        <!-- Block: RDS Cluster -->
        <div class="block rds-cluster">
            <i class="fas fa-database fa-2x"></i>
            <p>RDS Cluster</p>
        </div>

        <!-- SVG to house the arrow -->
        <svg class="arrow-line">
            <defs>
                <!-- Arrow marker (both ends) -->
                <marker
                        id="arrow"
                        markerWidth="10"
                        markerHeight="10"
                        refX="6"
                        refY="3"
                        orient="auto">
                    <path d="M0,0 L0,6 L6,3 z" fill="white"></path>
                </marker>
                <marker
                        id="arrow-reversed"
                        markerWidth="10"
                        markerHeight="10"
                        refX="0"
                        refY="3"
                        orient="auto"
                >
                    <!-- This path is essentially the horizontal mirror of the default right-pointing arrow -->
                    <!-- The tip is at (0,3), i.e. left edge, making the arrow point left -->
                    <path d="M6,0 L6,6 L0,3 z" fill="white"/>
                </marker>
            </defs>

            <!-- The line we will programmatically position & animate.
                 Give it an ID so we can manipulate it in JS. -->
            <line
                    id="dynamic-arrow"
                    stroke="white"
                    stroke-width="2"
                    marker-start="url(#arrow-reversed)"
                    marker-end="url(#arrow)"
                    stroke-dasharray="10"
                    stroke-dashoffset="10"
            />
        </svg>
    </div>
</div>


<div id="step-1" class="step-block show" data-step="1">
    <div class="diagram-container" style="position: relative; width: 100%; height: 100%; margin-top: 1rem;">

        <!-- Title / Label for clarity -->
        <!-- vtgate (left) -->
        <div class="vtgate-block block"
             style="position: absolute; text-align: center; transform: translate(-50%, -50%);">
            <i class="fas fa-route fa-2x" style="color: white;"></i>
            <p style="color: white; margin: 0.5rem 0 0;"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;vtgate&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</p>
        </div>

        <!-- Middle row: etcd, vtorc, vtctld (slightly below vtgate) -->
        <div class="etcd-block block"
             style="position: absolute; left: 40%; top: 30%; text-align: center; transform: translate(-50%, -50%);">
            <i class="fas fa-sitemap fa-2x" style="color: white;"></i>
            <p style="color: white; margin: 0.5rem 0 0;">etcd</p>
        </div>

        <div class="vtorc-block block"
             style="position: absolute; left: 50%; top: 50%; text-align: center; transform: translate(-50%, -50%);">
            <i class="fas fa-cogs fa-2x" style="color: white;"></i>
            <p style="color: white; margin: 0.5rem 0 0;">vtorc</p>
        </div>

        <div class="vtctld-block block"
             style="position: absolute; left: 60%; top: 30%; text-align: center; transform: translate(-50%, -50%);">
            <i class="fas fa-tools fa-2x" style="color: white;"></i>
            <p style="color: white; margin: 0.5rem 0 0;">vtctld</p>
        </div>

        <!-- Shard 1 (top-right) -->
        <div class="shard-1 block" style="position: absolute; left: 85%; top: 20%; transform: translate(-50%, -50%);">
            <!-- vttablet above MySQL -->
            <div class="vttablet-block" style="text-align: center;">
                <i class="fas fa-server fa-2x" style="color: white;"></i>
                <p style="color: white; margin: 0.5rem 0 0;">vttablet</p>
            </div>
            <div class="mysql-block" style="text-align: center; margin-top: 1rem;">
                <i class="fas fa-database fa-2x" style="color: white;"></i>
                <p style="color: white; margin: 0.5rem 0 0;">mysql</p>
            </div>
        </div>
        <!-- Shard 2 (bottom-right) -->
        <div class="shard-2 block" style="position: absolute; left: 85%; top: 75%; transform: translate(-50%, -50%);">
            <div class="vttablet-block" style="text-align: center;padding-bottom:20px">
                <i class="fas fa-server fa-2x" style="color: white;"></i>
                <p style="color: white; margin: 0.5rem 0 0;">vttablet</p>
            </div>
            <div class="mysql-block" style="text-align: center; margin-top: 1rem;">
                <i class="fas fa-database fa-2x" style="color: white;"></i>
                <p style="color: white; margin: 0.5rem 0 0;">mysql</p>
            </div>
        </div>

        <!-- SVG for lines/arrows -->
        <svg style="position: absolute; width: 100%; height: 100%; top: 0; left: 0;">
            <defs>
                <!-- Arrow marker for bidirectional lines -->
                <marker
                        id="arrow"
                        markerWidth="10"
                        markerHeight="10"
                        refX="6"
                        refY="3"
                        orient="auto">
                    <path d="M0,0 L0,6 L6,3 z" fill="white" />
                </marker>
            </defs>

            <!-- Example lines (hard-coded approximate coords).
                 In a real scenario, youâ€™d calculate x1,y1,x2,y2 dynamically
                 or refine these after measuring element positions. -->

            <!-- Bidirectional from vtgate => shard-1 vttablet -->
            <line x1="15%" y1="40%" x2="80%" y2="19%"
                  stroke="white" stroke-width="2"
                  marker-start="url(#arrow)" marker-end="url(#arrow)"/>

            <!-- Bidirectional from vtgate => shard-2 vttablet -->
            <line x1="15%" y1="40%" x2="80%" y2="59%"
                  stroke="white" stroke-width="2"
                  marker-start="url(#arrow)" marker-end="url(#arrow)"/>

            <!-- Dotted lines from each component to etcd (illustration only).
                 Suppose vtorc -> etcd: -->
            <line x1="50%" y1="50%" x2="40%" y2="30%"
                  stroke="white" stroke-dasharray="4" stroke-width="2"/>

            <!-- vtgate -> etcd -->
            <line x1="5%" y1="40%" x2="40%" y2="30%"
                  stroke="white" stroke-dasharray="4" stroke-width="2"/>

            <!-- vtctld -> etcd -->
            <line x1="60%" y1="30%" x2="40%" y2="30%"
                  stroke="white" stroke-dasharray="4" stroke-width="2"/>

            <!-- Dotted lines from vtctld -> vttablets (both shards) -->
            <line x1="60%" y1="30%" x2="85%" y2="20%"
                  stroke="white" stroke-dasharray="4" stroke-width="2"/>
            <line x1="60%" y1="30%" x2="85%" y2="60%"
                  stroke="white" stroke-dasharray="4" stroke-width="2"/>

        </svg>

        <h2 style="position: absolute; left: 40%; top: 80%; text-align: center; transform: translate(-50%, -50%);color: white;">Vitess Cluster</h2>


    </div> <!-- end .diagram-container -->
</div>


<!-- Step 2 Content (initially hidden) -->
<div id="step-2" class="step-block" data-step="2">
    <!-- You will add your Step 2 animated elements here -->
</div>

<!-- Step 3 Content (initially hidden) -->
<div id="step-3" class="step-block" data-step="3">
    <!-- You will add your Step 3 animated elements here -->
</div>

<!-- Step 4 Content (initially hidden) -->
<div id="step-4" class="step-block" data-step="4">
    <!-- You will add your Step 4 animated elements here -->
</div>

<script>

    // Attach event listeners to each button
    document.querySelectorAll('.step-btn').forEach(btn => {
        btn.addEventListener('click', () => {
            let chosenStep = parseInt(btn.getAttribute('data-step'));

            // For each step-block, check its data-step
            document.querySelectorAll('.step-block').forEach(block => {
                const blockStep = parseInt(block.getAttribute('data-step'));
                if (blockStep <= chosenStep) {
                    // Show (accumulate) all steps up to and including chosenStep
                    block.classList.add('show');
                } else {
                    // Hide steps beyond the chosen one
                    block.classList.remove('show');
                }
            });
        });
    });
</script>

<script>

    function positionAndAnimateArrow0() {
        const container = document.querySelector('.diagram-container');
        const userApp = document.querySelector('.user-app');
        const rds = document.querySelector('.rds-cluster');
        const arrowLine = document.getElementById('dynamic-arrow');

        // Get bounding rects for container and each block
        const containerRect = container.getBoundingClientRect();
        const userRect = userApp.getBoundingClientRect();
        const rdsRect = rds.getBoundingClientRect();

        // Calculate arrow start (right-center of user block)
        const x1 = (userRect.right - containerRect.left);
        const y1 = ((userRect.top + userRect.bottom) / 2) - containerRect.top;

        // Calculate arrow end (left-center of RDS block)
        const x2 = (rdsRect.left - containerRect.left);
        const y2 = ((rdsRect.top + rdsRect.bottom) / 2) - containerRect.top;

        // Update the line coordinates
        arrowLine.setAttribute('x1', x1);
        arrowLine.setAttribute('y1', y1);
        arrowLine.setAttribute('x2', x2);
        arrowLine.setAttribute('y2', y2);

        // Animate the arrow
        gsap.fromTo(
            arrowLine,
            {strokeDashoffset: 100},
            {
                strokeDashoffset: 1,
                duration: 5,
                ease: 'power1.inOut',
                repeat: -1,
                yoyo: true
            }
        );
    }

    document.addEventListener('DOMContentLoaded', () => {
        // Basic step-switching logic from before
        document.querySelectorAll('.step-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                const targetStep = btn.getAttribute('data-step');
                document.querySelectorAll('.step-block').forEach(step => {
                    step.classList.remove('active-step');
                });
                const newStepContent = document.getElementById(`step-${targetStep}`);
                newStepContent.classList.add('active-step');

                // If the user just clicked Step 0, run the arrow-draw animation
                if (targetStep === '0') {
                    positionAndAnimateArrow0();
                }
            });
        });

        // Also run arrow positioning/animation on initial load (Step 0)
        positionAndAnimateArrow0();

    });

    window.addEventListener('resize', () => {
        const step0 = document.getElementById('step-0');
        // Ensure we're only repositioning the arrow if Step 0 is displayed
        if (step0.classList.contains('show')) {
            positionAndAnimateArrow0(); // your arrow-drawing function
        }
    });
</script>


<script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
<script src="js/animation.js"></script>

</body>
</html>